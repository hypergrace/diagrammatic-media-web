{# Auto Gallery Module - Nunjucks Version Automatically displays all images from
a project folder. Usage: {% include "auto-gallery-njk.njk", { project_folder:
"project-name", columns: 3 } %} This will look for images in:
/assets/projects/project-name/ #} {%- set project_images =
projectGalleries[project_folder] -%} {%- if project_images and
project_images.length > 0 -%} {%- set gallery_id = "auto-gallery-" +
project_folder -%} {%- set columns = columns or 3 -%}

<div class="photo-gallery" data-columns="{{ columns }}">
  <div class="gallery-grid" id="{{ gallery_id }}">
    {%- for image in project_images -%}
    <div class="gallery-item">
      <img
        src="{{ image.path }}"
        alt="{{ image.name | replace('-', ' ') | replace('_', ' ') | title }}"
        loading="lazy"
        class="gallery-image"
        onclick="openLightbox('{{ gallery_id }}', {{ loop.index0 }})"
      />
      <div class="gallery-caption">
        {{ image.name | replace('-', ' ') | replace('_', ' ') | title }}
      </div>
    </div>
    {%- endfor -%}
  </div>
</div>

<!-- Lightbox Modal -->
<div
  id="{{ gallery_id }}-lightbox"
  class="lightbox-overlay"
  onclick="closeLightbox('{{ gallery_id }}')"
>
  <div class="lightbox-container">
    <span class="lightbox-close" onclick="closeLightbox('{{ gallery_id }}')"
      >&times;</span
    >
    <img
      id="{{ gallery_id }}-lightbox-img"
      class="lightbox-image"
      src=""
      alt=""
    />
    <div id="{{ gallery_id }}-lightbox-caption" class="lightbox-caption"></div>
    <div class="lightbox-nav">
      <button
        class="lightbox-prev"
        onclick="navigateLightbox('{{ gallery_id }}', -1)"
      >
        &#8249;
      </button>
      <button
        class="lightbox-next"
        onclick="navigateLightbox('{{ gallery_id }}', 1)"
      >
        &#8250;
      </button>
    </div>
  </div>
</div>

<script>
  // Auto Gallery functionality for {{ gallery_id }}
  (function() {
    const galleryData = {{ project_images | dump | safe }}.map(img => ({
      src: img.path,
      alt: img.name.replace(/-/g, ' ').replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()),
      caption: img.name.replace(/-/g, ' ').replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())
    }));
    let currentImageIndex = 0;

    window.openLightbox = window.openLightbox || function(galleryId, index) {
      if (galleryId !== '{{ gallery_id }}') return;

      currentImageIndex = index;
      const lightbox = document.getElementById(galleryId + '-lightbox');
      const img = document.getElementById(galleryId + '-lightbox-img');
      const caption = document.getElementById(galleryId + '-lightbox-caption');

      img.src = galleryData[index].src;
      img.alt = galleryData[index].alt;
      caption.textContent = galleryData[index].caption || '';

      lightbox.style.display = 'flex';
      document.body.style.overflow = 'hidden';
    };

    window.closeLightbox = window.closeLightbox || function(galleryId) {
      if (galleryId !== '{{ gallery_id }}') return;

      const lightbox = document.getElementById(galleryId + '-lightbox');
      lightbox.style.display = 'none';
      document.body.style.overflow = 'auto';
    };

    window.navigateLightbox = window.navigateLightbox || function(galleryId, direction) {
      if (galleryId !== '{{ gallery_id }}') return;

      currentImageIndex += direction;

      if (currentImageIndex < 0) {
        currentImageIndex = galleryData.length - 1;
      } else if (currentImageIndex >= galleryData.length) {
        currentImageIndex = 0;
      }

      openLightbox(galleryId, currentImageIndex);
    };

    // Keyboard navigation
    document.addEventListener('keydown', function(e) {
      const lightbox = document.getElementById('{{ gallery_id }}-lightbox');
      if (lightbox && lightbox.style.display === 'flex') {
        if (e.key === 'Escape') {
          closeLightbox('{{ gallery_id }}');
        } else if (e.key === 'ArrowLeft') {
          navigateLightbox('{{ gallery_id }}', -1);
        } else if (e.key === 'ArrowRight') {
          navigateLightbox('{{ gallery_id }}', 1);
        }
      }
    });
  })();
</script>

{%- endif -%}
