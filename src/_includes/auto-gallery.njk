{% comment %} Auto Gallery Module - Liquid Version Automatically displays all
images from a project folder. Usage: {% assign project_folder = "the-gift" %} {%
assign gallery_columns = 3 %} {% include "auto-gallery.njk" %} This will look
for images in: /assets/projects/the-gift/ {% endcomment %} {% assign
project_images = projectGalleries[project_folder] %} {% if project_images and
project_images.size > 0 %} {% assign gallery_id = "auto-gallery-" | append:
project_folder %} {% assign columns = gallery_columns | default: 3 %}

<div class="photo-gallery" data-columns="{{ columns }}">
  <div class="gallery-grid" id="{{ gallery_id }}">
    {% for image in project_images %}
    <div class="gallery-item">
      <img
        src="{{ image.path }}"
        alt="{{ image.name | replace: '-', ' ' | replace: '_', ' ' | capitalize }}"
        loading="lazy"
        class="gallery-image"
        onclick="window['openLightbox_{{ gallery_id }}']({{ forloop.index0 }})"
      />
      <div class="gallery-caption">
        {{ image.name | replace: '-', ' ' | replace: '_', ' ' | capitalize }}
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<!-- Lightbox Modal -->
<div
  id="{{ gallery_id }}-lightbox"
  class="lightbox-overlay"
  onclick="window['closeLightbox_{{ gallery_id }}']()"
>
  <div class="lightbox-container" onclick="event.stopPropagation()">
    <span class="lightbox-close" onclick="window['closeLightbox_{{ gallery_id }}']()"
      >&times;</span
    >
    <img
      id="{{ gallery_id }}-lightbox-img"
      class="lightbox-image"
      src=""
      alt=""
    />
    <div id="{{ gallery_id }}-lightbox-caption" class="lightbox-caption"></div>
    <div class="lightbox-nav">
      <button
        class="lightbox-prev"
        onclick="event.stopPropagation(); window['navigateLightbox_{{ gallery_id }}'](-1)"
      >
        &lt;
      </button>
      <button
        class="lightbox-next"
        onclick="event.stopPropagation(); window['navigateLightbox_{{ gallery_id }}'](1)"
      >
        &gt;
      </button>
    </div>
  </div>
</div>

<script>
  // Auto Gallery functionality for {{ gallery_id }}
  (function() {
    const galleryId = '{{ gallery_id }}';
    const galleryData = [
      {% for image in project_images %}
        {
          src: "{{ image.path }}",
          alt: "{{ image.name | replace: '-', ' ' | replace: '_', ' ' | capitalize | escape }}",
          caption: "{{ image.name | replace: '-', ' ' | replace: '_', ' ' | capitalize | escape }}"
        }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ];
    let currentImageIndex = 0;

    // Create unique function names for this gallery
    window['openLightbox_' + galleryId] = function(index) {
      currentImageIndex = index;
      const lightbox = document.getElementById(galleryId + '-lightbox');
      const img = document.getElementById(galleryId + '-lightbox-img');
      const caption = document.getElementById(galleryId + '-lightbox-caption');

      img.src = galleryData[index].src;
      img.alt = galleryData[index].alt;
      caption.textContent = galleryData[index].caption || '';

      lightbox.style.display = 'flex';
      document.body.style.overflow = 'hidden';
    };

    window['closeLightbox_' + galleryId] = function() {
      const lightbox = document.getElementById(galleryId + '-lightbox');
      lightbox.style.display = 'none';
      document.body.style.overflow = 'auto';
    };

    window['navigateLightbox_' + galleryId] = function(direction) {
      currentImageIndex += direction;

      if (currentImageIndex < 0) {
        currentImageIndex = galleryData.length - 1;
      } else if (currentImageIndex >= galleryData.length) {
        currentImageIndex = 0;
      }

      window['openLightbox_' + galleryId](currentImageIndex);
    };

    // Keyboard navigation
    document.addEventListener('keydown', function(e) {
      const lightbox = document.getElementById(galleryId + '-lightbox');
      if (lightbox && lightbox.style.display === 'flex') {
        if (e.key === 'Escape') {
          window['closeLightbox_' + galleryId]();
        } else if (e.key === 'ArrowLeft') {
          window['navigateLightbox_' + galleryId](-1);
        } else if (e.key === 'ArrowRight') {
          window['navigateLightbox_' + galleryId](1);
        }
      }
    });
  })();
</script>

{% else %} {% comment %}No images found for this project{% endcomment %} {%
endif %}
